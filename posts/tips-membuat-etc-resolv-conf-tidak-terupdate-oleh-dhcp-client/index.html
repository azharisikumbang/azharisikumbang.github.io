<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Eleventy v3.0.0">
    
    
    <meta name="description" content="Software Engineer">
    
    <title>Tips Mencegah /etc/resolv.conf Terupdate Otomatis Oleh DHCP Client</title>

    <link rel="stylesheet" href="/styles/app.css"> 
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JRF181NEQ3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JRF181NEQ3');
    </script>
    <script src="/scripts/app.js" type="text/javascript"></script>
</head>
<body>
    <nav class="border-gray-200 mx-auto border-b">
    <div class="flex flex-wrap items-center justify-between mx-auto p-4 container">
        <a href="https://azharisaputra.web.id" class="flex items-center space-x-3 rtl:space-x-reverse text-green-600">
            <span class="self-center text-2xl font-semibold whitespace-nowrap">Azhari Saputra</span>
        </a>
        <button data-collapse-toggle="navbar-default" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" aria-controls="navbar-default" aria-expanded="false">
            <span class="sr-only">Open main menu</span>
            <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
            </svg>
        </button>
        <div class="hidden w-full md:block md:w-auto" id="navbar-default">
        <ul class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white">
            <li>
            <a href="https://azharisaputra.web.id/" class="block hover:underline py-2 px-3 text-green-600 rounded-sm md:p-0" aria-current="page">Home</a>
            </li>
            <li>
            <a href="https://azharisaputra.web.id/projects" class="block hover:underline py-2 px-3 text-green-600 rounded-sm md:p-0" aria-current="page">Projects</a>
            </li>
            <li>
            <a href="https://azharisaputra.web.id/blog" class="block hover:underline py-2 px-3 text-green-600 rounded-sm md:p-0" aria-current="page">Blog</a>
            </li>
            <li>
            <a href="https://azharisaputra.web.id/contact" class="block hover:underline py-2 px-3 text-green-600 rounded-sm md:p-0" aria-current="page">Contact</a>
            </li>
            <li>
            <a href="https://azharisaputra.web.id/media/resume.pdf" class="block hover:underline py-2 px-3 text-green-600 rounded-sm md:p-0 underline" aria-current="page">Resume</a>
            </li>
        </ul>
        </div>
    </div>
</nav>


    <article class="w-full prose lg:prose-xl !max-w-none mx-auto">
    <div class="max-w-screen-xl mx-auto">
        <div class="py-8 lg:py-16 px-4">
            <a href="/blog" class="text-gray-500 hover:underline hover:text-green-700">./kembali</a>
            <h1 class="text-3xl md:text-4xl font-display mb-4 font-bold text-green-600">Tips Mencegah /etc/resolv.conf Terupdate Otomatis Oleh DHCP Client</h1>
            <p class="mb-4 text-grey-light italic text-small"> posted at
              <time datetime="Fri Jun 05 2020 00:00:00 GMT+0000 (Coordinated Universal Time)">2020-06-05</time>
            </p>
            <div class="">
              <!--kg-card-begin: html-->
<p>Assalamualaikum Wr. Wb</p>
<p>Sebagaimana sebuah layanan DHCP tentu akan memberikan beberapa service kepada clientnya. Hal ini adalah wajar jika ketika kita melakukan <em>request </em>DHCP ke server DHCP, maka kita akan mendapatkan sebuah (atau beberapa) ip dns server. </p>
<p>Dan tentu saja, konfigurasi file dns server kita akan secara tidak langsung berubah. Hal ini sebenarnya tidak menjadi masalah. Hanya saja, bagaimana jika saya mempunyai konfigurasi ip dns sendiri dan membuatnya dilewatkan ketika meminta request dhcp? </p>
<p><em>Baca Juga : <a href="https://coretanit.com/tutorial-install-dan-konfigurasi-bind9-ubuntu">Tutorial Install dan Konfigurasi DNS Server dengan Bind9 pada Ubuntu Server</a></em></p>
<p>Pada kasus ini, saya menggunakan laptop yang terkoneksi dengan sebuah wifi akses poin. Dan, informasi dns bisa dicek di file <em><code>/etc/resolv.conf</code></em>  dengan perintah.</p>
<pre class="wp-block-code"><code>$ cat /etc/resolv.conf</code></pre>
<figure class="wp-block-image size-large"><img loading="lazy" width="736" height="337" src="/content/images/wordpress/2020/06/image-3.png" alt="" class="wp-image-1377" srcset="/content/images/wordpress/2020/06/image-3.png 736w, http://localhost:2368/content/images/wordpress/2020/06/image-3-300x137.png 300w" sizes="(max-width: 736px) 100vw, 736px" /></figure>
<p>Nah, terlihat informasi dns digenerate oleh service network manager, dan berikut konfigurasi dari Network Manager saya, bisa dilihat dengan perintah</p>
<pre class="wp-block-code"><code>$ cat /etc/NetworkManager/NetworkManager.conf</code></pre>
<figure class="wp-block-image size-large"><img loading="lazy" width="736" height="537" src="/content/images/wordpress/2020/06/image-4.png" alt="" class="wp-image-1378" srcset="/content/images/wordpress/2020/06/image-4.png 736w, http://localhost:2368/content/images/wordpress/2020/06/image-4-300x219.png 300w" sizes="(max-width: 736px) 100vw, 736px" /></figure>
<p>Dan yang akan kita lakukan adalah kita ingin mengubah konfigurasi file <code>/etc/resolv.conf </code>tidak digenerate dan tidak terupdate secara otomatis oleh service dhcp client. Karena normalnya setiap terkoneksi dengan jaringan bari secara dhcp, konfigurasi jaringan kita juga akan terupdate seperti ip address, gateway, dns dan sebagainya.</p>
<p>Dan terkhusus untuk dns, dalam mencegah /etc/resolv.conf terupdate dhcp bisa dengan beberapa cara, berikut caranya.</p>
<ol><li>Memproteksi File <code>/etc/resolv.conf</code></li><li>Menggunakan DHCP Hooks</li><li>Mentiadakan DNS pada service Network Manager</li><li>Mengkonfigurasi file dhclient.conf</li></ol>
<p>Sebagai contoh saya akan mengalihkan dns saya ke dns milik google dan dns milik <a href="https://www.opendns.com/">opendns</a>.</p>
<pre class="wp-block-code"><code>nameserver 8.8.8.8 # dns google
nameserver 208.67.222.222 # opendns</code></pre>
<p>Untuk mengubah konfig file /etc/resolv.conf bisa dengan nano, vim, gedit dan sebagainya. Contoh dengan nano sebagai berikut.</p>
<pre class="wp-block-code"><code>$ sudo nano /etc/resolv.conf</code></pre>
<p>Kemudian rubah menjadi setingan berikut dan simpan dengan <em><code>CTRL + X</code></em> dan pilih <em><code>Y</code></em> (yes)</p>
<figure class="wp-block-image size-large"><img loading="lazy" width="736" height="537" src="/content/images/wordpress/2020/06/image-5.png" alt="" class="wp-image-1379" srcset="/content/images/wordpress/2020/06/image-5.png 736w, http://localhost:2368/content/images/wordpress/2020/06/image-5-300x219.png 300w" sizes="(max-width: 736px) 100vw, 736px" /></figure>
<p>Nah seharusnya dns server kita telah berubah. Tapi untuk menjawab rasa penasaran bahwa file ini akan selalu terupdate secara otomatis apabila kita terkoneksi dengan jaringan baru, bisa dilihat dengan perintah berikut.</p>
<pre class="wp-block-code"><code>$ sudo systemctl restart NetworkManager</code></pre>
<p>Woopss.. dan setingan kita kembali ke awal lagi,, hal ini lah yang akan kita cegah.</p>
<figure class="wp-block-image size-large"><img loading="lazy" width="736" height="537" src="/content/images/wordpress/2020/06/image-6.png" alt="" class="wp-image-1380" srcset="/content/images/wordpress/2020/06/image-6.png 736w, http://localhost:2368/content/images/wordpress/2020/06/image-6-300x219.png 300w" sizes="(max-width: 736px) 100vw, 736px" /></figure>
<h2>Cara 1: Memproteksi File /etc/resolv.conf</h2>
<p>Cukup mudah untuk melakukan dengan cara ini dan terbilang cara ini adalah cara yang universal. Proteksi yang dilakukan adalah mencegah sistem untuk melakukan editing terhadap file yang kita tergertkan. </p>
<p>Dan karena kasus ini file targetnya adalah <code>/etc/resolv.conf</code>, maka kita proteksi dengan perintah berikut.</p>
<pre class="wp-block-code"><code>$ sudo chattr +i /etc/resolv.conf </code></pre>
<p>Dan opsi <code>+i</code> pada perintah diatas akan mencegah siapapun untuk melakukan perubahan, termasuk root dari komputer kita.</p>
<p>Dan sedangkan untuk menghilangkan kembali proteksinya bisa dengan perintah berikut.</p>
<pre class="wp-block-code"><code>$ sudo chattr -i /etc/resolv.conf </code></pre>
<p>Untuk melakukan testing apakah berubah silahkan disesuaikan lagi dns server yang diinginkan di file <code>/etc/resolv.conf</code> dan lakukan restart terhadap service network nya. <em>(cek kembali ke atas untuk caranya)</em></p>
<h2>Cara 2: Menggunakan DNS Hooks</h2>
<p>Dalam melakukan pencegahan, sangat direkomendasikan menggunakan cara ini dibanding dengan cara pertama. Cara ini akan membuat sebuah script yang akan dijalankan oleh <code>dhclient</code>. Script ini akan menyesuaikan kondisi interfaces jaringan kita setiap kali akan melakukan request dhcp.</p>
<p>Script yang didefenisikan adalah fungsi <code>make_resolv_conf</code> yang akan menimpa default dari file <code>/etc/resolv.conf</code></p>
<p>Script ini nantinya bernama <code>nodnsupdate</code> dan terletak di folder <code>/etc/dhcp/dhclient-enter-hooks.d/</code></p>
<pre class="wp-block-code"><code>$ sudo nano /etc/dhcp/dhclient-enter-hooks.d/nodnsupdate</code></pre>
<p>Kemudian isikan dengan script berikut dan simpan dengan <code>CTRL + X</code> dan pilih <code>Y</code>.</p>
<pre class="wp-block-code"><code>#!/bin/sh
make_resolv_conf(){
    :
}</code></pre>
<p>Selanjutnya kita perlu mengubah hak akses nya agar bisa dieksekusi.</p>
<pre class="wp-block-code"><code>$ sudo chmod +x /etc/dhcp/dhclient-enter-hooks.d/nodnsupdate</code></pre>
<p>Silahkan di reboot, dan seharusnya script ini akan menimpa method default <code>make_resolv_conf</code>, serta silahkan edit sesuai keinginan file /etc/resolv.conf karena tidak akan terjadi lagi pengubahan secara dari dhcp client.  </p>
<h2>Cara 3: Mentiadakan DNS pada service Network Manager</h2>
<p>Cara ini cukup mudah ketika ingin mencegah <code>/etc/resolv.con</code>f terupdate dhcp client, jika kita lihat pada file konfigurasi network manager di <code>/etc/NetworkManager/NetworkManager.conf</code>, maka kita akan menemukan pada section <code>main</code>, terdapat konfig <code>dns=default</code>. Setingan default ini akan memberikan ip dns dengan konfigurasi default dari server. </p>
<p>Untuk mencegah hal ini cukup mengubah konfig dns dari <code>default</code> menjadi <code>none</code>, atau jika tidak terdapat bisa ditambahkan saja.</p>
<p>Pertama masuk dan edit dengan perintah berikut</p>
<pre class="wp-block-code"><code>$ sudo nano /etc/NetworkManager/NetworkManager.conf</code></pre>
<p>Dan ubah menjadi sebagai berikut dan simpan.</p>
<pre class="wp-block-code"><code>[main]
plugins=ifupdown,keyfile
dns=none

[ifupdown]
managed=false

[device]
wifi.scan-rand-mac-address=no</code></pre>
<p>Selanjutnya silahkan <code>reboot</code>, dan sesuaikan ip dns yang diinginkan.</p>
<h2>Cara 4: Mengkonfigurasi file dhclient.conf</h2>
<p>Selain beberapa cara diatas, untuk mencegah (atau lebih tepatnya mendefaultkan konfigurasi) perubahan ip dns kita bisa dengan mengubah/menambahkan sedikit konfigurasi pada file <code>dhclient.conf</code></p>
<p>Silahkan masuk dan edit file tersebut.</p>
<pre class="wp-block-code"><code>$ sudo nano /etc/dhcp/dhclient.conf</code></pre>
<p>Jika diperhatikan file ini akan beriksi banyak konfigurasi, tapi tidak usah diganggu, tapi jika kalian suka eksperimen, gass keun saja.</p>
<p>Pada file konfigurasi tersebut silahkan tambahkan baris berikut</p>
<pre class="wp-block-code"><code>supersede domain-name-servers 8.8.8.8, 208.67.222.222;</code></pre>
<p>atau bisa juga dan direkomendasikan dengan baris berikut.</p>
<pre class="wp-block-code"><code>prepend domain-name-servers 8.8.8.8, 208.67.222.222;</code></pre>
<blockquote class="wp-block-quote"><p><em>Ip 8.8.8.8 dan 208.67.222.222 hanya contoh saja, silahkan disesuaikan dengan konfigurasi masing masing.</em> <em> </em></p></blockquote>
<p>Dan pada konfigurasi ini silahkan reboot komputer anda dan secara default dns akan di set ke ip tersebut.</p>
<p></p>
<!--kg-card-end: html-->

            </div>            
        </div>
    </div>
</article>


    <footer class="bg-black w-full text-white">
        <div class="container mx-auto">
            <div class="py-8 lg:py-16 px-4 xl:flex xl:justify-between text-left sm:text-center">
                 <div>
                    &copy; 2023 - Azhari Saputra (<a href="mailto:contact@azharisaputra.web.id" class="hover:text-green-700 hover:underline">contact@azharisaputra.web.id</a>)
                </div>
                 <div>
                    Generated with <a href="https://www.11ty.dev" class="hover:text-green-700 hover:underline">11ty.dev</a> -
                    <a href="https://github.com/azharisikumbang/azharisikumbang.github.io/tree/new-theme" class="hover:text-green-700 hover:underline">Get Theme here </a>
                 </div>
            </div>
        </div>
    </footer>
</body>
</html>
